# Configurazione Supabase per l'applicazione

## Introduzione

Supabase è una piattaforma open-source che fornisce tutti gli strumenti di backend necessari per costruire un'applicazione. Include un database PostgreSQL, autenticazione, storage di file, e API RESTful.

Questa guida ti mostrerà come configurare Supabase per salvare le risposte del questionario.

## Passo 1: Crea un nuovo progetto Supabase

1. Vai su [https://supabase.com/](https://supabase.com/) e accedi o crea un nuovo account
2. Fai clic su "New Project"
3. Inserisci un nome per il progetto (es. "questionario-xpl4b")
4. Imposta una password sicura per il database
5. Seleziona la regione più vicina a te
6. Fai clic su "Create new project"

## Passo 2: Crea la tabella per le risposte

1. Nel pannello di controllo Supabase, vai alla sezione "SQL Editor"
2. Fai clic su "New Query" e incolla il seguente codice SQL:

```sql
-- Crea tabella per le risposte del sondaggio
CREATE TABLE survey_responses (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  question TEXT NOT NULL,
  liked BOOLEAN NOT NULL,
  selected_options TEXT,
  custom_feedback TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Imposta le autorizzazioni
ALTER TABLE survey_responses ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Inserimento pubblico risposte" ON "public"."survey_responses" 
  FOR INSERT WITH CHECK (true);
```

3. Fai clic su "Run" per eseguire la query

## Passo 3: Ottieni le credenziali API

1. Nel pannello di controllo Supabase, vai a "Settings" -> "API"
2. Nella sezione "Project API keys", copia i seguenti valori:
   - URL: `[your-project-url]`
   - `anon` public key: `[your-anon-key]`
   - `service_role` secret key: `[your-service-role-key]`

## Passo 4: Configura le variabili d'ambiente su Vercel

1. Nel pannello di controllo Vercel, vai al tuo progetto
2. Vai nella sezione "Settings" -> "Environment Variables"
3. Aggiungi le seguenti variabili d'ambiente:
   - `NEXT_PUBLIC_SUPABASE_URL`: [your-project-url]
   - `SUPABASE_SERVICE_KEY`: [your-service-role-key]

> **Nota importante**: Assicurati di mantenere il `SUPABASE_SERVICE_KEY` segreto e mai esporlo nel codice frontend.

## Passo 5: Configura le variabili d'ambiente localmente

Crea o aggiorna il file `.env.local` nella radice del progetto con i seguenti valori:

```
NEXT_PUBLIC_SUPABASE_URL=https://[your-project-id].supabase.co
SUPABASE_SERVICE_KEY=your-service-role-key
```

## Passo 6: Testa l'integrazione

1. Avvia l'applicazione in locale
2. Compila il questionario e invia le risposte
3. Verifica nel pannello di controllo Supabase che le risposte siano state salvate correttamente

## Visualizzazione dei dati

Puoi visualizzare le risposte salvate in diverse modalità:

1. **Dashboard Supabase**:
   - Vai alla sezione "Table Editor"
   - Seleziona la tabella "survey_responses"

2. **Esportazione in CSV**:
   - Dal "Table Editor", fai clic su "Export" e scegli il formato desiderato
   
3. **Query SQL personalizzate**:
   - Usa la sezione "SQL Editor" per eseguire query avanzate sui dati

## Recupero dati via API

Se desideri creare un pannello admin per visualizzare i risultati, puoi utilizzare le API Supabase per recuperare i dati:

```typescript
const { data, error } = await supabase
  .from('survey_responses')
  .select('*')
  .order('created_at', { ascending: false });
```

## Risorse utili

- [Documentazione Supabase](https://supabase.com/docs)
- [API Reference](https://supabase.com/docs/reference)
- [Guida agli errori comuni](https://supabase.com/docs/guides/database/debugging-errors)
